<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Longitudinal models with upper-level predictors | Generalized Linear Mixed Models with R: A tutorial</title>
  <meta name="description" content="10 Longitudinal models with upper-level predictors | Generalized Linear Mixed Models with R: A tutorial" />
  <meta name="generator" content="bookdown 0.46 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Longitudinal models with upper-level predictors | Generalized Linear Mixed Models with R: A tutorial" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Longitudinal models with upper-level predictors | Generalized Linear Mixed Models with R: A tutorial" />
  
  
  

<meta name="author" content="Rick Hass" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="using-lme4-to-fit-mlm-to-longitudinal-data.html"/>
<link rel="next" href="multilevel-logistic-regression.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="1" data-path="r-basics.html"><a href="r-basics.html"><i class="fa fa-check"></i><b>1</b> R Basics</a>
<ul>
<li class="chapter" data-level="1.1" data-path="r-basics.html"><a href="r-basics.html#what-is-coding"><i class="fa fa-check"></i><b>1.1</b> What is “coding”</a></li>
<li class="chapter" data-level="1.2" data-path="r-basics.html"><a href="r-basics.html#r-console-versus-the-rstudio-script"><i class="fa fa-check"></i><b>1.2</b> R Console versus the RStudio Script</a></li>
<li class="chapter" data-level="1.3" data-path="r-basics.html"><a href="r-basics.html#working-with-data"><i class="fa fa-check"></i><b>1.3</b> Working with data</a></li>
<li class="chapter" data-level="1.4" data-path="r-basics.html"><a href="r-basics.html#using-a-script-to-generate-data-and-computing-the-mean-and-standard-deviation"><i class="fa fa-check"></i><b>1.4</b> Using a script to generate data, and computing the mean and standard deviation</a></li>
<li class="chapter" data-level="1.5" data-path="r-basics.html"><a href="r-basics.html#importing-data"><i class="fa fa-check"></i><b>1.5</b> Importing Data</a></li>
<li class="chapter" data-level="1.6" data-path="r-basics.html"><a href="r-basics.html#reading-in-an-spss-file"><i class="fa fa-check"></i><b>1.6</b> Reading in an SPSS file</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="r-basics.html"><a href="r-basics.html#a-quick-note-on-indexing"><i class="fa fa-check"></i><b>1.6.1</b> A quick note on indexing</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="r-basics.html"><a href="r-basics.html#frequencies-and-contingency-tables"><i class="fa fa-check"></i><b>1.7</b> Frequencies and Contingency Tables</a></li>
<li class="chapter" data-level="1.8" data-path="r-basics.html"><a href="r-basics.html#descriptive-statistics"><i class="fa fa-check"></i><b>1.8</b> Descriptive statistics</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="r-basics.html"><a href="r-basics.html#the-describe-function"><i class="fa fa-check"></i><b>1.8.1</b> The describe function</a></li>
<li class="chapter" data-level="1.8.2" data-path="r-basics.html"><a href="r-basics.html#the-describeby-function"><i class="fa fa-check"></i><b>1.8.2</b> The describeBy function</a></li>
<li class="chapter" data-level="1.8.3" data-path="r-basics.html"><a href="r-basics.html#computing-a-new-variable-and-adding-it-to-the-dataframe"><i class="fa fa-check"></i><b>1.8.3</b> Computing a new variable and adding it to the dataframe</a></li>
</ul></li>
<li class="chapter" data-level="1.9" data-path="r-basics.html"><a href="r-basics.html#visualizing-data"><i class="fa fa-check"></i><b>1.9</b> Visualizing Data</a>
<ul>
<li class="chapter" data-level="1.9.1" data-path="r-basics.html"><a href="r-basics.html#histograms-and-density-plots"><i class="fa fa-check"></i><b>1.9.1</b> Histograms and density plots</a></li>
<li class="chapter" data-level="1.9.2" data-path="r-basics.html"><a href="r-basics.html#boxplots"><i class="fa fa-check"></i><b>1.9.2</b> Boxplots</a></li>
<li class="chapter" data-level="1.9.3" data-path="r-basics.html"><a href="r-basics.html#scatterplots"><i class="fa fa-check"></i><b>1.9.3</b> Scatterplots</a></li>
</ul></li>
<li class="chapter" data-level="1.10" data-path="r-basics.html"><a href="r-basics.html#review"><i class="fa fa-check"></i><b>1.10</b> Review</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ordinary-linear-regression.html"><a href="ordinary-linear-regression.html"><i class="fa fa-check"></i><b>2</b> Ordinary Linear Regression</a>
<ul>
<li class="chapter" data-level="2.1" data-path="ordinary-linear-regression.html"><a href="ordinary-linear-regression.html#our-data"><i class="fa fa-check"></i><b>2.1</b> Our data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="ordinary-linear-regression.html"><a href="ordinary-linear-regression.html#converting-from-numeric-to-factor"><i class="fa fa-check"></i><b>2.1.1</b> Converting from numeric to factor</a></li>
<li class="chapter" data-level="2.1.2" data-path="ordinary-linear-regression.html"><a href="ordinary-linear-regression.html#confidence-intervals-v.-p-values"><i class="fa fa-check"></i><b>2.1.2</b> Confidence Intervals v. p-values</a></li>
<li class="chapter" data-level="2.1.3" data-path="ordinary-linear-regression.html"><a href="ordinary-linear-regression.html#adding-interaction-terms"><i class="fa fa-check"></i><b>2.1.3</b> Adding interaction terms</a></li>
<li class="chapter" data-level="2.1.4" data-path="ordinary-linear-regression.html"><a href="ordinary-linear-regression.html#interaction-model-for-gambling"><i class="fa fa-check"></i><b>2.1.4</b> Interaction model for Gambling</a></li>
<li class="chapter" data-level="2.1.5" data-path="ordinary-linear-regression.html"><a href="ordinary-linear-regression.html#interaction-output"><i class="fa fa-check"></i><b>2.1.5</b> Interaction Output</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="ordinary-linear-regression.html"><a href="ordinary-linear-regression.html#anova-and-drop1-commands"><i class="fa fa-check"></i><b>2.2</b> ANOVA and drop1 commands</a></li>
<li class="chapter" data-level="2.3" data-path="ordinary-linear-regression.html"><a href="ordinary-linear-regression.html#plots"><i class="fa fa-check"></i><b>2.3</b> Plots</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>3</b> Logistic Regression</a>
<ul>
<li class="chapter" data-level="3.1" data-path="logistic-regression.html"><a href="logistic-regression.html#an-example-diabetes-risk-factors"><i class="fa fa-check"></i><b>3.1</b> An Example: Diabetes risk factors</a></li>
<li class="chapter" data-level="3.2" data-path="logistic-regression.html"><a href="logistic-regression.html#model-discrimination-and-fit"><i class="fa fa-check"></i><b>3.2</b> Model Discrimination and Fit</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="logistic-regression.html"><a href="logistic-regression.html#roc-and-auroc"><i class="fa fa-check"></i><b>3.2.1</b> ROC and AUROC</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="regression-with-counts-as-outcomes.html"><a href="regression-with-counts-as-outcomes.html"><i class="fa fa-check"></i><b>4</b> Regression with Counts as Outcomes</a>
<ul>
<li class="chapter" data-level="4.1" data-path="regression-with-counts-as-outcomes.html"><a href="regression-with-counts-as-outcomes.html#example-data-phmc-fruits-question"><i class="fa fa-check"></i><b>4.1</b> Example data: PHMC Fruits question</a></li>
<li class="chapter" data-level="4.2" data-path="regression-with-counts-as-outcomes.html"><a href="regression-with-counts-as-outcomes.html#coefficients-in-poisson-models"><i class="fa fa-check"></i><b>4.2</b> Coefficients in Poisson Models</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="regression-with-counts-as-outcomes.html"><a href="regression-with-counts-as-outcomes.html#exponentiated-coefficients-interpretation"><i class="fa fa-check"></i><b>4.2.1</b> Exponentiated Coefficients Interpretation</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="regression-with-counts-as-outcomes.html"><a href="regression-with-counts-as-outcomes.html#overdispersion-and-other-count-regression-models"><i class="fa fa-check"></i><b>4.3</b> Overdispersion and other count regression models</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="regression-with-counts-as-outcomes.html"><a href="regression-with-counts-as-outcomes.html#overdispersion-and-zero-inflation"><i class="fa fa-check"></i><b>4.3.1</b> Overdispersion and Zero-inflation</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="regression-with-counts-as-outcomes.html"><a href="regression-with-counts-as-outcomes.html#zero-inflated-models"><i class="fa fa-check"></i><b>4.4</b> Zero-inflated models</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="model-fit-and-assumptions-for-glms.html"><a href="model-fit-and-assumptions-for-glms.html"><i class="fa fa-check"></i><b>5</b> Model Fit and Assumptions for GLMs</a>
<ul>
<li class="chapter" data-level="5.1" data-path="model-fit-and-assumptions-for-glms.html"><a href="model-fit-and-assumptions-for-glms.html#model-checking-and-diagnostics-in-ordinary-least-squares"><i class="fa fa-check"></i><b>5.1</b> Model Checking and Diagnostics in Ordinary Least Squares</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="model-fit-and-assumptions-for-glms.html"><a href="model-fit-and-assumptions-for-glms.html#residuals-v.-fitted-values"><i class="fa fa-check"></i><b>5.1.1</b> Residuals v. Fitted Values</a></li>
<li class="chapter" data-level="5.1.2" data-path="model-fit-and-assumptions-for-glms.html"><a href="model-fit-and-assumptions-for-glms.html#normalty-of-residuals"><i class="fa fa-check"></i><b>5.1.2</b> Normalty of residuals</a></li>
<li class="chapter" data-level="5.1.3" data-path="model-fit-and-assumptions-for-glms.html"><a href="model-fit-and-assumptions-for-glms.html#leverage"><i class="fa fa-check"></i><b>5.1.3</b> Leverage</a></li>
<li class="chapter" data-level="5.1.4" data-path="model-fit-and-assumptions-for-glms.html"><a href="model-fit-and-assumptions-for-glms.html#influence"><i class="fa fa-check"></i><b>5.1.4</b> Influence</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="model-fit-and-assumptions-for-glms.html"><a href="model-fit-and-assumptions-for-glms.html#model-checking-and-diagnostics-in-logistic-regression"><i class="fa fa-check"></i><b>5.2</b> Model Checking and Diagnostics in Logistic Regression</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="model-fit-and-assumptions-for-glms.html"><a href="model-fit-and-assumptions-for-glms.html#hosmer-lemeshow-test"><i class="fa fa-check"></i><b>5.2.1</b> Hosmer-Lemeshow Test</a></li>
<li class="chapter" data-level="5.2.2" data-path="model-fit-and-assumptions-for-glms.html"><a href="model-fit-and-assumptions-for-glms.html#nagelkerkes-pseudo-r-squared"><i class="fa fa-check"></i><b>5.2.2</b> Nagelkerke’s pseudo R-squared</a></li>
<li class="chapter" data-level="5.2.3" data-path="model-fit-and-assumptions-for-glms.html"><a href="model-fit-and-assumptions-for-glms.html#residuals-and-leverages"><i class="fa fa-check"></i><b>5.2.3</b> Residuals and leverages</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="model-fit-and-assumptions-for-glms.html"><a href="model-fit-and-assumptions-for-glms.html#summary"><i class="fa fa-check"></i><b>5.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="introducing-mixed-models-and-the-lme4-package.html"><a href="introducing-mixed-models-and-the-lme4-package.html"><i class="fa fa-check"></i><b>6</b> Introducing mixed-models and the lme4 package</a>
<ul>
<li class="chapter" data-level="6.1" data-path="introducing-mixed-models-and-the-lme4-package.html"><a href="introducing-mixed-models-and-the-lme4-package.html#options-in-r"><i class="fa fa-check"></i><b>6.1</b> Options in R</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="introducing-mixed-models-and-the-lme4-package.html"><a href="introducing-mixed-models-and-the-lme4-package.html#why-lme4"><i class="fa fa-check"></i><b>6.1.1</b> Why lme4?</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="introducing-mixed-models-and-the-lme4-package.html"><a href="introducing-mixed-models-and-the-lme4-package.html#a-possible-workflow"><i class="fa fa-check"></i><b>6.2</b> A possible workflow</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="introducing-mixed-models-and-the-lme4-package.html"><a href="introducing-mixed-models-and-the-lme4-package.html#high-school-and-beyond"><i class="fa fa-check"></i><b>6.2.1</b> High School and Beyond</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="introducing-mixed-models-and-the-lme4-package.html"><a href="introducing-mixed-models-and-the-lme4-package.html#model-1-one-way-random-effects-anova-using-reml"><i class="fa fa-check"></i><b>6.3</b> Model 1: one-way random-effects ANOVA using REML</a></li>
<li class="chapter" data-level="6.4" data-path="introducing-mixed-models-and-the-lme4-package.html"><a href="introducing-mixed-models-and-the-lme4-package.html#quasi-anova-estimator"><i class="fa fa-check"></i><b>6.4</b> Quasi-ANOVA estimator</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="introducing-mixed-models-and-the-lme4-package.html"><a href="introducing-mixed-models-and-the-lme4-package.html#unrestricted-maximum-likelihood"><i class="fa fa-check"></i><b>6.4.1</b> (unrestricted) Maximum Likelihood</a></li>
<li class="chapter" data-level="6.4.2" data-path="introducing-mixed-models-and-the-lme4-package.html"><a href="introducing-mixed-models-and-the-lme4-package.html#intraclass-correlation"><i class="fa fa-check"></i><b>6.4.2</b> Intraclass correlation</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="introducing-mixed-models-and-the-lme4-package.html"><a href="introducing-mixed-models-and-the-lme4-package.html#bootstrapped-confidence-intervals"><i class="fa fa-check"></i><b>6.5</b> Bootstrapped confidence intervals</a></li>
<li class="chapter" data-level="6.6" data-path="introducing-mixed-models-and-the-lme4-package.html"><a href="introducing-mixed-models-and-the-lme4-package.html#linear-mixed-effects"><i class="fa fa-check"></i><b>6.6</b> Linear mixed-effects</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="introducing-mixed-models-and-the-lme4-package.html"><a href="introducing-mixed-models-and-the-lme4-package.html#random-effects-estimates"><i class="fa fa-check"></i><b>6.6.1</b> Random effects estimates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="mixed-models-as-hierarchical-linear-models.html"><a href="mixed-models-as-hierarchical-linear-models.html"><i class="fa fa-check"></i><b>7</b> Mixed models as Hierarchical Linear Models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="mixed-models-as-hierarchical-linear-models.html"><a href="mixed-models-as-hierarchical-linear-models.html#high-school-and-beyond-data"><i class="fa fa-check"></i><b>7.1</b> High School and Beyond Data</a></li>
<li class="chapter" data-level="7.2" data-path="mixed-models-as-hierarchical-linear-models.html"><a href="mixed-models-as-hierarchical-linear-models.html#model-1-unconditional-model"><i class="fa fa-check"></i><b>7.2</b> Model 1: unconditional model</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="mixed-models-as-hierarchical-linear-models.html"><a href="mixed-models-as-hierarchical-linear-models.html#unconditional-icc"><i class="fa fa-check"></i><b>7.2.1</b> Unconditional ICC</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="mixed-models-as-hierarchical-linear-models.html"><a href="mixed-models-as-hierarchical-linear-models.html#means-as-outcomes-binary-predictor"><i class="fa fa-check"></i><b>7.3</b> Means as outcomes: Binary Predictor</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="mixed-models-as-hierarchical-linear-models.html"><a href="mixed-models-as-hierarchical-linear-models.html#means-as-outcomes-continuous-predictor"><i class="fa fa-check"></i><b>7.3.1</b> Means as outcomes: continuous predictor</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="mixed-models-as-hierarchical-linear-models.html"><a href="mixed-models-as-hierarchical-linear-models.html#multiple-hierarchical-linear-regression"><i class="fa fa-check"></i><b>7.4</b> Multiple hierarchical linear regression</a></li>
<li class="chapter" data-level="7.5" data-path="mixed-models-as-hierarchical-linear-models.html"><a href="mixed-models-as-hierarchical-linear-models.html#plotting-predictor-effects"><i class="fa fa-check"></i><b>7.5</b> Plotting predictor effects</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="more-on-hierarchical-linear-models.html"><a href="more-on-hierarchical-linear-models.html"><i class="fa fa-check"></i><b>8</b> More on Hierarchical Linear Models</a>
<ul>
<li class="chapter" data-level="8.1" data-path="more-on-hierarchical-linear-models.html"><a href="more-on-hierarchical-linear-models.html#overview-1"><i class="fa fa-check"></i><b>8.1</b> Overview</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="more-on-hierarchical-linear-models.html"><a href="more-on-hierarchical-linear-models.html#load-the-data"><i class="fa fa-check"></i><b>8.1.1</b> Load the data</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="more-on-hierarchical-linear-models.html"><a href="more-on-hierarchical-linear-models.html#random-coefficients-model"><i class="fa fa-check"></i><b>8.2</b> Random Coefficients model</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="more-on-hierarchical-linear-models.html"><a href="more-on-hierarchical-linear-models.html#visualizing-the-within-school-slopes"><i class="fa fa-check"></i><b>8.2.1</b> Visualizing the within-school slopes</a></li>
<li class="chapter" data-level="8.2.2" data-path="more-on-hierarchical-linear-models.html"><a href="more-on-hierarchical-linear-models.html#fitting-the-random-coefficients-2-level-model"><i class="fa fa-check"></i><b>8.2.2</b> Fitting the Random Coefficients 2-level model</a></li>
<li class="chapter" data-level="8.2.3" data-path="more-on-hierarchical-linear-models.html"><a href="more-on-hierarchical-linear-models.html#adding-additional-level-1-predictors-to-the-random-coefficients-model"><i class="fa fa-check"></i><b>8.2.3</b> Adding additional level-1 predictors to the random coefficients model</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="more-on-hierarchical-linear-models.html"><a href="more-on-hierarchical-linear-models.html#intercepts-and-slopes-as-outcomes"><i class="fa fa-check"></i><b>8.3</b> Intercepts and Slopes as Outcomes</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="more-on-hierarchical-linear-models.html"><a href="more-on-hierarchical-linear-models.html#interactions-and-the-iso-model"><i class="fa fa-check"></i><b>8.3.1</b> Interactions and the ISO model</a></li>
<li class="chapter" data-level="8.3.2" data-path="more-on-hierarchical-linear-models.html"><a href="more-on-hierarchical-linear-models.html#mean-ses-and-student-ses"><i class="fa fa-check"></i><b>8.3.2</b> Mean SES and Student SES</a></li>
<li class="chapter" data-level="8.3.3" data-path="more-on-hierarchical-linear-models.html"><a href="more-on-hierarchical-linear-models.html#sector-and-student-ses"><i class="fa fa-check"></i><b>8.3.3</b> Sector and Student SES</a></li>
<li class="chapter" data-level="8.3.4" data-path="more-on-hierarchical-linear-models.html"><a href="more-on-hierarchical-linear-models.html#visualizing-the-mean-ses-effect"><i class="fa fa-check"></i><b>8.3.4</b> Visualizing the mean SES effect</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="more-on-hierarchical-linear-models.html"><a href="more-on-hierarchical-linear-models.html#model-comparison-with-likelihood-ratios-fixed-and-random"><i class="fa fa-check"></i><b>8.4</b> Model comparison with Likelihood Ratios: Fixed and Random</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="more-on-hierarchical-linear-models.html"><a href="more-on-hierarchical-linear-models.html#example-1-lrt-for-fixed-effects"><i class="fa fa-check"></i><b>8.4.1</b> Example 1: LRT for fixed effects</a></li>
<li class="chapter" data-level="8.4.2" data-path="more-on-hierarchical-linear-models.html"><a href="more-on-hierarchical-linear-models.html#example-2-lrt-for-random-effects"><i class="fa fa-check"></i><b>8.4.2</b> Example 2: LRT for random effects</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="more-on-hierarchical-linear-models.html"><a href="more-on-hierarchical-linear-models.html#diagnostics"><i class="fa fa-check"></i><b>8.5</b> Diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="using-lme4-to-fit-mlm-to-longitudinal-data.html"><a href="using-lme4-to-fit-mlm-to-longitudinal-data.html"><i class="fa fa-check"></i><b>9</b> Using lme4 to fit MLM to longitudinal data</a>
<ul>
<li class="chapter" data-level="9.1" data-path="using-lme4-to-fit-mlm-to-longitudinal-data.html"><a href="using-lme4-to-fit-mlm-to-longitudinal-data.html#data-description-average-reaction-time-per-day-for-subjects-in-a-sleep-deprivation-study-belenky-et-al.-2003"><i class="fa fa-check"></i><b>9.1</b> Data description: average reaction time per day for subjects in a sleep deprivation study (Belenky et al. 2003)</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="using-lme4-to-fit-mlm-to-longitudinal-data.html"><a href="using-lme4-to-fit-mlm-to-longitudinal-data.html#visualization-of-the-data"><i class="fa fa-check"></i><b>9.1.1</b> Visualization of the data</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="using-lme4-to-fit-mlm-to-longitudinal-data.html"><a href="using-lme4-to-fit-mlm-to-longitudinal-data.html#fitting-the-level-1-model"><i class="fa fa-check"></i><b>9.2</b> Fitting the level-1 model</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="using-lme4-to-fit-mlm-to-longitudinal-data.html"><a href="using-lme4-to-fit-mlm-to-longitudinal-data.html#model-equations"><i class="fa fa-check"></i><b>9.2.1</b> Model Equations</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="using-lme4-to-fit-mlm-to-longitudinal-data.html"><a href="using-lme4-to-fit-mlm-to-longitudinal-data.html#model-building"><i class="fa fa-check"></i><b>9.3</b> Model building</a></li>
<li class="chapter" data-level="9.4" data-path="using-lme4-to-fit-mlm-to-longitudinal-data.html"><a href="using-lme4-to-fit-mlm-to-longitudinal-data.html#model-comparison-and-testing"><i class="fa fa-check"></i><b>9.4</b> Model comparison and testing</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="using-lme4-to-fit-mlm-to-longitudinal-data.html"><a href="using-lme4-to-fit-mlm-to-longitudinal-data.html#option-1-using-confidence-intervals"><i class="fa fa-check"></i><b>9.4.1</b> Option 1: using confidence intervals</a></li>
<li class="chapter" data-level="9.4.2" data-path="using-lme4-to-fit-mlm-to-longitudinal-data.html"><a href="using-lme4-to-fit-mlm-to-longitudinal-data.html#tests"><i class="fa fa-check"></i><b>9.4.2</b> Tests</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="using-lme4-to-fit-mlm-to-longitudinal-data.html"><a href="using-lme4-to-fit-mlm-to-longitudinal-data.html#quadratic-model-with-lmer"><i class="fa fa-check"></i><b>9.5</b> Quadratic model with lmer</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="using-lme4-to-fit-mlm-to-longitudinal-data.html"><a href="using-lme4-to-fit-mlm-to-longitudinal-data.html#a-note-on-quadratic-terms"><i class="fa fa-check"></i><b>9.5.1</b> A note on quadratic terms</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="using-lme4-to-fit-mlm-to-longitudinal-data.html"><a href="using-lme4-to-fit-mlm-to-longitudinal-data.html#summary-of-the-sleepstudy-analysis"><i class="fa fa-check"></i><b>9.6</b> Summary of the sleepstudy analysis</a></li>
<li class="chapter" data-level="9.7" data-path="using-lme4-to-fit-mlm-to-longitudinal-data.html"><a href="using-lme4-to-fit-mlm-to-longitudinal-data.html#preview-of-the-blackmore-data-used-for-assignment-7b"><i class="fa fa-check"></i><b>9.7</b> Preview of the Blackmore data used for Assignment 7b</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="using-lme4-to-fit-mlm-to-longitudinal-data.html"><a href="using-lme4-to-fit-mlm-to-longitudinal-data.html#a-note-on-the-age-variable-in-blackmore"><i class="fa fa-check"></i><b>9.7.1</b> A note on the age variable in Blackmore</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="longitudinal-models-with-upper-level-predictors.html"><a href="longitudinal-models-with-upper-level-predictors.html"><i class="fa fa-check"></i><b>10</b> Longitudinal models with upper-level predictors</a>
<ul>
<li class="chapter" data-level="10.1" data-path="longitudinal-models-with-upper-level-predictors.html"><a href="longitudinal-models-with-upper-level-predictors.html#overview-2"><i class="fa fa-check"></i><b>10.1</b> Overview</a></li>
<li class="chapter" data-level="10.2" data-path="longitudinal-models-with-upper-level-predictors.html"><a href="longitudinal-models-with-upper-level-predictors.html#part-1-intercepts-and-slopes-as-outcomes"><i class="fa fa-check"></i><b>10.2</b> Part 1: Intercepts and Slopes as Outcomes</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="longitudinal-models-with-upper-level-predictors.html"><a href="longitudinal-models-with-upper-level-predictors.html#a-short-tutorial-on-ggplot2"><i class="fa fa-check"></i><b>10.2.1</b> A short tutorial on ggplot2</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="longitudinal-models-with-upper-level-predictors.html"><a href="longitudinal-models-with-upper-level-predictors.html#adding-level-2-predictors"><i class="fa fa-check"></i><b>10.3</b> Adding level 2 predictors</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="longitudinal-models-with-upper-level-predictors.html"><a href="longitudinal-models-with-upper-level-predictors.html#transforming-the-exercise-variable"><i class="fa fa-check"></i><b>10.3.1</b> Transforming the Exercise Variable</a></li>
<li class="chapter" data-level="10.3.2" data-path="longitudinal-models-with-upper-level-predictors.html"><a href="longitudinal-models-with-upper-level-predictors.html#steps-1-and-2"><i class="fa fa-check"></i><b>10.3.2</b> Steps 1 and 2:</a></li>
<li class="chapter" data-level="10.3.3" data-path="longitudinal-models-with-upper-level-predictors.html"><a href="longitudinal-models-with-upper-level-predictors.html#step-3"><i class="fa fa-check"></i><b>10.3.3</b> Step 3:</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="longitudinal-models-with-upper-level-predictors.html"><a href="longitudinal-models-with-upper-level-predictors.html#summary-1"><i class="fa fa-check"></i><b>10.4</b> Summary</a></li>
<li class="chapter" data-level="10.5" data-path="longitudinal-models-with-upper-level-predictors.html"><a href="longitudinal-models-with-upper-level-predictors.html#adding-level-2-explanatory-variables"><i class="fa fa-check"></i><b>10.5</b> Adding Level-2 Explanatory variables</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="longitudinal-models-with-upper-level-predictors.html"><a href="longitudinal-models-with-upper-level-predictors.html#visualizing-the-transformed-data"><i class="fa fa-check"></i><b>10.5.1</b> Visualizing the transformed data</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="longitudinal-models-with-upper-level-predictors.html"><a href="longitudinal-models-with-upper-level-predictors.html#time-dependent-covariates"><i class="fa fa-check"></i><b>10.6</b> Time dependent covariates</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="longitudinal-models-with-upper-level-predictors.html"><a href="longitudinal-models-with-upper-level-predictors.html#level-1-time-dependent-sports-predictor"><i class="fa fa-check"></i><b>10.6.1</b> Level-1: Time-dependent sports predictor</a></li>
<li class="chapter" data-level="10.6.2" data-path="longitudinal-models-with-upper-level-predictors.html"><a href="longitudinal-models-with-upper-level-predictors.html#level-2-participant-level-indicator-of-sports-participation"><i class="fa fa-check"></i><b>10.6.2</b> Level-2: Participant-level indicator of sports participation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="multilevel-logistic-regression.html"><a href="multilevel-logistic-regression.html"><i class="fa fa-check"></i><b>11</b> Multilevel logistic regression</a>
<ul>
<li class="chapter" data-level="11.1" data-path="multilevel-logistic-regression.html"><a href="multilevel-logistic-regression.html#unconditional-model"><i class="fa fa-check"></i><b>11.1</b> Unconditional model</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="multilevel-logistic-regression.html"><a href="multilevel-logistic-regression.html#fitting-the-model"><i class="fa fa-check"></i><b>11.1.1</b> Fitting the model</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="multilevel-logistic-regression.html"><a href="multilevel-logistic-regression.html#conditional-model"><i class="fa fa-check"></i><b>11.2</b> Conditional model</a></li>
<li class="chapter" data-level="11.3" data-path="multilevel-logistic-regression.html"><a href="multilevel-logistic-regression.html#interpreting-odds-ratios"><i class="fa fa-check"></i><b>11.3</b> Interpreting odds ratios</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="mlm-v.-gee-for-binary-outcomes.html"><a href="mlm-v.-gee-for-binary-outcomes.html"><i class="fa fa-check"></i><b>12</b> MLM v. GEE for Binary Outcomes</a>
<ul>
<li class="chapter" data-level="12.1" data-path="mlm-v.-gee-for-binary-outcomes.html"><a href="mlm-v.-gee-for-binary-outcomes.html#overview-3"><i class="fa fa-check"></i><b>12.1</b> Overview</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="mlm-v.-gee-for-binary-outcomes.html"><a href="mlm-v.-gee-for-binary-outcomes.html#dataset"><i class="fa fa-check"></i><b>12.1.1</b> Dataset</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="mlm-v.-gee-for-binary-outcomes.html"><a href="mlm-v.-gee-for-binary-outcomes.html#hlm-model"><i class="fa fa-check"></i><b>12.2</b> HLM Model</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="mlm-v.-gee-for-binary-outcomes.html"><a href="mlm-v.-gee-for-binary-outcomes.html#interpreting-odds-ratios-1"><i class="fa fa-check"></i><b>12.2.1</b> Interpreting odds ratios</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="mlm-v.-gee-for-binary-outcomes.html"><a href="mlm-v.-gee-for-binary-outcomes.html#population-average-model-with-gee"><i class="fa fa-check"></i><b>12.3</b> Population Average Model with GEE</a></li>
<li class="chapter" data-level="12.4" data-path="mlm-v.-gee-for-binary-outcomes.html"><a href="mlm-v.-gee-for-binary-outcomes.html#hlm-with-level-2-predictors"><i class="fa fa-check"></i><b>12.4</b> HLM with level-2 predictors</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="mlm-v.-gee-for-binary-outcomes.html"><a href="mlm-v.-gee-for-binary-outcomes.html#random-slopes-1"><i class="fa fa-check"></i><b>12.4.1</b> Random slopes</a></li>
<li class="chapter" data-level="12.4.2" data-path="mlm-v.-gee-for-binary-outcomes.html"><a href="mlm-v.-gee-for-binary-outcomes.html#level-2-predictors"><i class="fa fa-check"></i><b>12.4.2</b> Level 2 predictors</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="mlm-v.-gee-for-binary-outcomes.html"><a href="mlm-v.-gee-for-binary-outcomes.html#compare-to-gee"><i class="fa fa-check"></i><b>12.5</b> Compare to GEE</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="mlm-v.-gee-for-binary-outcomes.html"><a href="mlm-v.-gee-for-binary-outcomes.html#visualizing-res"><i class="fa fa-check"></i><b>12.5.1</b> Visualizing REs</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Generalized Linear Mixed Models with R: A tutorial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="longitudinal-models-with-upper-level-predictors" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">10</span> Longitudinal models with upper-level predictors<a href="longitudinal-models-with-upper-level-predictors.html#longitudinal-models-with-upper-level-predictors" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="overview-2" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Overview<a href="longitudinal-models-with-upper-level-predictors.html#overview-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This week’s tutorial covers three topics:</p>
<ol style="list-style-type: decimal">
<li>The intercepts-and-slopes as outcomes model in a longitudinal analysis</li>
<li>Some more information on using <code>ggplot2</code></li>
<li>Quick look at time-dependent covariates</li>
</ol>
<p>Packages required</p>
<ul>
<li><code>car</code></li>
<li><code>lme4</code></li>
<li><code>ggplot2</code></li>
</ul>
</div>
<div id="part-1-intercepts-and-slopes-as-outcomes" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Part 1: Intercepts and Slopes as Outcomes<a href="longitudinal-models-with-upper-level-predictors.html#part-1-intercepts-and-slopes-as-outcomes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>Davis, Blackmore, Katzman, and Fox (2005) study on the exercise <em>histories</em> of a patient group of 138 teenage girls hospitalized for eating disorders and of 93 comparable control subjects. At the time of data collection, the girls and their parents were interviewed, and based on the interviews, an estimate of the average number of hours per week of exercise was constructed at each subject’s current age, which varied from girl to girl, and in most cases at 2-year intervals in the past, starting at age 8. Thus, the response variable, exercise, was measured at several different ages for each girl, with most subjects measured four or five times and a few measured two or three times. We are interested in modeling change in exercise with age and particularly in examining the potential difference in typical exercise trajectories between patients and control subjects. The data for the study are in the data frame Blackmore (named after the researcher who collected the data) in the carData package:</p>
</blockquote>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb308-1" tabindex="-1"></a>Blackmore<span class="sc">$</span>agegroup <span class="ot">&lt;-</span> <span class="fu">with</span>(Blackmore,</span>
<span id="cb308-2"><a href="longitudinal-models-with-upper-level-predictors.html#cb308-2" tabindex="-1"></a>    <span class="fu">cut</span>(age, <span class="fu">quantile</span>(age, <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>)),</span>
<span id="cb308-3"><a href="longitudinal-models-with-upper-level-predictors.html#cb308-3" tabindex="-1"></a>        <span class="at">include.lowest=</span><span class="cn">TRUE</span>))</span>
<span id="cb308-4"><a href="longitudinal-models-with-upper-level-predictors.html#cb308-4" tabindex="-1"></a></span>
<span id="cb308-5"><a href="longitudinal-models-with-upper-level-predictors.html#cb308-5" tabindex="-1"></a><span class="co"># intercept is the end of the study (current time)</span></span>
<span id="cb308-6"><a href="longitudinal-models-with-upper-level-predictors.html#cb308-6" tabindex="-1"></a>Blackmore<span class="sc">$</span>endcentered <span class="ot">&lt;-</span> Blackmore<span class="sc">$</span>age <span class="sc">-</span> <span class="fu">max</span>(Blackmore<span class="sc">$</span>age)</span>
<span id="cb308-7"><a href="longitudinal-models-with-upper-level-predictors.html#cb308-7" tabindex="-1"></a></span>
<span id="cb308-8"><a href="longitudinal-models-with-upper-level-predictors.html#cb308-8" tabindex="-1"></a><span class="co"># intercept is the average age for the group</span></span>
<span id="cb308-9"><a href="longitudinal-models-with-upper-level-predictors.html#cb308-9" tabindex="-1"></a>Blackmore<span class="sc">$</span>midcentered <span class="ot">&lt;-</span> Blackmore<span class="sc">$</span>age <span class="sc">-</span> <span class="fu">mean</span>(Blackmore<span class="sc">$</span>age)</span>
<span id="cb308-10"><a href="longitudinal-models-with-upper-level-predictors.html#cb308-10" tabindex="-1"></a></span>
<span id="cb308-11"><a href="longitudinal-models-with-upper-level-predictors.html#cb308-11" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> group <span class="sc">+</span> agegroup, <span class="at">data=</span>Blackmore)</span></code></pre></div>
<pre><code>##          agegroup
## group     [8,10] (10,12] (12,14] (14,17.9]
##   control    185      60      58        56
##   patient    275     118      83       110</code></pre>
<div id="a-short-tutorial-on-ggplot2" class="section level3 hasAnchor" number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> A short tutorial on ggplot2<a href="longitudinal-models-with-upper-level-predictors.html#a-short-tutorial-on-ggplot2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s try a different visualization to preview our level-2 results. This visualization is much like the one that we used for (cross-sectional) Model 4.</p>
<p>This uses the <code>ggplot2</code> <a href="https://ggplot2.tidyverse.org/">package</a>
This package has become a standard with R users because it is very well documented and very flexible. However, it takes a bit of getting used to. This is a <a href="https://r4ds.hadley.nz/data-visualize.html">link</a> to the package author (Hadley Wickham’s) book chapter on how it works.</p>
<p>A <code>ggplot</code> is built in steps. These can be executed one at a time or in steps. To illustrate, let’s build a plot in several steps. The key is that we can save the plot that we build first and then manipulate it. The way these plots are constructed is based on the <em>grammar of graphics,</em> and that’s what makes it a bit cumbersome, but after a while it becomes second nature (though of course, I look things up constantly in the help pages!).</p>
<p>The first thing we’re going to do is to create the basic plot area and tell <code>ggplot</code> where the data are. Then, we’re going to we’re going to add a layer of points and map those points to our data. We can’t do anything, of course, if we don’t attach the <code>ggplot2</code> package… (note: the package is called <code>ggplot2</code> but the main function is <code>ggplot()</code>).</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb310-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb310-2"><a href="longitudinal-models-with-upper-level-predictors.html#cb310-2" tabindex="-1"></a></span>
<span id="cb310-3"><a href="longitudinal-models-with-upper-level-predictors.html#cb310-3" tabindex="-1"></a><span class="fu">ggplot</span>(Blackmore) <span class="sc">+</span> <span class="co"># tell ggplot where the data are</span></span>
<span id="cb310-4"><a href="longitudinal-models-with-upper-level-predictors.html#cb310-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> exercise)) </span></code></pre></div>
<p><img src="_main_files/figure-html/plot_blackmore_110-1.png" width="672" /></p>
<p>The <code>+</code> sign is part of the package and separates layers and other options. It’s not uncommon to have several <code>+</code> as you add more options. In RStudio, type the <code>+</code> and then press return (or Enter) and the cursor will move the next line and indent. This helps organize the code so that each line contains one layer or option.</p>
<p>Next, let’s add some color. There are two ways we might use color. One is mundane, and that is to color all the points the same. Let’s do that first, and then let’s do something more interesting, let’s color points according to whether the girl was part of the control group or a “patient” in the Blackmore study. Also, this time, I’m not going to save the plot. You’ll note that when you run the code it will appear. The reason I’m not adding to the already saved plot is we’re modifying the options within one layer (the <code>geom_point</code> layer).</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb311-1" tabindex="-1"></a><span class="fu">ggplot</span>(Blackmore) <span class="sc">+</span> </span>
<span id="cb311-2"><a href="longitudinal-models-with-upper-level-predictors.html#cb311-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> exercise), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="co"># color all the points blue</span></span></code></pre></div>
<p><img src="_main_files/figure-html/plot_blackmore_210-1.png" width="672" /></p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb312-1" tabindex="-1"></a><span class="fu">ggplot</span>(Blackmore) <span class="sc">+</span> </span>
<span id="cb312-2"><a href="longitudinal-models-with-upper-level-predictors.html#cb312-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> exercise, <span class="at">color =</span> group)) <span class="co"># color according to group</span></span></code></pre></div>
<p><img src="_main_files/figure-html/plot_blackmore_210-2.png" width="672" /></p>
<p>OK, this is more helpful for data exploration. We can sort of see a trend, though the relationship is not exactly linear. It looks like the girls in the patient group were exercising more at the end of the study. It’s hard to see because the age variable only takes on certain values (is nearly discrete). To help us see all the points, we’ll add what is called <em>jitter.</em> This option adds a small bit of noise (a very small normally distributed number) to each point and sort of, well, <em>jitters</em> it.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb313-1" tabindex="-1"></a><span class="fu">ggplot</span>(Blackmore) <span class="sc">+</span> </span>
<span id="cb313-2"><a href="longitudinal-models-with-upper-level-predictors.html#cb313-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> exercise, <span class="at">color =</span> group), <span class="at">position =</span> <span class="st">&quot;jitter&quot;</span>) <span class="co"># add jitter</span></span></code></pre></div>
<p><img src="_main_files/figure-html/plot_blackmore_310-1.png" width="672" /></p>
<p>So we see a bit better now, but there’s something a bit funny about our dataset besides the discrete age values. We can see this a bit better if we use <code>ggplot</code> to make a histogram for age and then add color to see whether there’s a difference between the two groups. By default, the <code>geom_bar</code> function in <code>ggplot2</code> plots count data, so it makes a histogram, which isn’t always what we want, but here it is. As you’ll see below, exercise is positively skewed. This is why your level 1 models might have fit weirdly. We’ll deal with that a little later.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb314-1" tabindex="-1"></a><span class="fu">ggplot</span>(Blackmore) <span class="sc">+</span> </span>
<span id="cb314-2"><a href="longitudinal-models-with-upper-level-predictors.html#cb314-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> exercise, <span class="at">fill =</span> group), <span class="at">bins =</span> <span class="dv">15</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plot_blackmore_410-1.png" width="672" /></p>
<p>Back to our scatterplots, let’s do a bit of formatting before we move on to our analysis. There are many other plot layers we can add, for example using <code>geom_smooth()</code> we can add linear and nonparametric regression lines as in earlier vignettes. But since our data likely need some transformation, we’ll skip that. Most of the time, our variable label in our dataframe isn’t what we want on either axis. To change the axis labels, we use <code>labs()</code> as below. We’ll also change the colors of the dots with <code>scale_color_manual()</code>. Finally, we’ll add a pre-packaged theme for the plot <code>theme_minimal()</code>. This is just a small sample of all the things one can do with <code>ggplot</code>.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb315-1" tabindex="-1"></a><span class="fu">ggplot</span>(Blackmore) <span class="sc">+</span> </span>
<span id="cb315-2"><a href="longitudinal-models-with-upper-level-predictors.html#cb315-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> exercise, <span class="at">color =</span> group), <span class="at">position =</span> <span class="st">&quot;jitter&quot;</span>) <span class="sc">+</span></span>
<span id="cb315-3"><a href="longitudinal-models-with-upper-level-predictors.html#cb315-3" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey&quot;</span>,<span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb315-4"><a href="longitudinal-models-with-upper-level-predictors.html#cb315-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Estimated Exercise&quot;</span>) <span class="sc">+</span></span>
<span id="cb315-5"><a href="longitudinal-models-with-upper-level-predictors.html#cb315-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb315-6"><a href="longitudinal-models-with-upper-level-predictors.html#cb315-6" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> group, <span class="dv">2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/blackmore_410-1.png" width="672" /></p>
</div>
</div>
<div id="adding-level-2-predictors" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Adding level 2 predictors<a href="longitudinal-models-with-upper-level-predictors.html#adding-level-2-predictors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s start with the model using age centered with <span class="math inline">\(0\)</span> at the end of the study:</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb316-1" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(exercise <span class="sc">~</span> endcentered <span class="sc">+</span> (endcentered <span class="sc">|</span>subject), <span class="at">data =</span> Blackmore)</span>
<span id="cb316-2"><a href="longitudinal-models-with-upper-level-predictors.html#cb316-2" tabindex="-1"></a><span class="fu">sumary</span>(mod1)</span></code></pre></div>
<pre><code>## Fixed Effects:
##             coef.est coef.se
## (Intercept) 5.48     0.41   
## endcentered 0.45     0.04   
## 
## Random Effects:
##  Groups   Name        Std.Dev. Corr 
##  subject  (Intercept) 5.48          
##           endcentered 0.51     1.00 
##  Residual             1.98          
## ---
## number of obs: 945, groups: subject, 231
## AIC = 4452.5, DIC = 4426.2
## deviance = 4433.3</code></pre>
<div id="transforming-the-exercise-variable" class="section level3 hasAnchor" number="10.3.1">
<h3><span class="header-section-number">10.3.1</span> Transforming the Exercise Variable<a href="longitudinal-models-with-upper-level-predictors.html#transforming-the-exercise-variable" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before we proceed, we need to do something about the exercise variable. It’s clearly numeric and not a count variable, so it can’t be handled in a generlized model format (not part of the course). A quick fix with positively skewed data is a square-root transformation. This often shrinks the range, though our data will likely not be symmetrical.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb318-1" tabindex="-1"></a>Blackmore<span class="sc">$</span>rootEx <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(Blackmore<span class="sc">$</span>exercise)</span>
<span id="cb318-2"><a href="longitudinal-models-with-upper-level-predictors.html#cb318-2" tabindex="-1"></a></span>
<span id="cb318-3"><a href="longitudinal-models-with-upper-level-predictors.html#cb318-3" tabindex="-1"></a><span class="fu">ggplot</span>(Blackmore) <span class="sc">+</span></span>
<span id="cb318-4"><a href="longitudinal-models-with-upper-level-predictors.html#cb318-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> rootEx, <span class="at">fill =</span> group), <span class="at">bins =</span> <span class="dv">15</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/transform110-1.png" width="672" /></p>
<p>The result is probably good enough for us, but see Fox &amp; Weisberg for the Box-Cox transform of this data. Importantly, let’s see how our model is affected. Here I’m going to run steps 1-3 just using <code>endcentered</code> age. Note, the convergence problems are “solved” using a different optimzation routine. The reason that convergence is failing is because many of the slopes in the control group are close to zero.</p>
</div>
<div id="steps-1-and-2" class="section level3 hasAnchor" number="10.3.2">
<h3><span class="header-section-number">10.3.2</span> Steps 1 and 2:<a href="longitudinal-models-with-upper-level-predictors.html#steps-1-and-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb319-1" tabindex="-1"></a>mod1<span class="fl">.2</span>t <span class="ot">&lt;-</span> <span class="fu">lmer</span>(rootEx <span class="sc">~</span> endcentered <span class="sc">+</span> (endcentered<span class="sc">|</span>subject), <span class="at">data =</span> Blackmore, <span class="at">control =</span> <span class="fu">lmerControl</span>(<span class="at">optimizer =</span><span class="st">&quot;Nelder_Mead&quot;</span>))</span>
<span id="cb319-2"><a href="longitudinal-models-with-upper-level-predictors.html#cb319-2" tabindex="-1"></a><span class="fu">sumary</span>(mod1<span class="fl">.2</span>t)</span></code></pre></div>
<pre><code>## Fixed Effects:
##             coef.est coef.se
## (Intercept) 2.06     0.09   
## endcentered 0.12     0.01   
## 
## Random Effects:
##  Groups   Name        Std.Dev. Corr 
##  subject  (Intercept) 1.21          
##           endcentered 0.11     0.91 
##  Residual             0.52          
## ---
## number of obs: 945, groups: subject, 231
## AIC = 2050.6, DIC = 2014.7
## deviance = 2026.6</code></pre>
</div>
<div id="step-3" class="section level3 hasAnchor" number="10.3.3">
<h3><span class="header-section-number">10.3.3</span> Step 3:<a href="longitudinal-models-with-upper-level-predictors.html#step-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here, instead of using the <code>sumary</code> command from the <code>faraway</code> package, I’ll use the full <code>summary</code>. Also, we’ll use the ordinary likelihood-ratio test from <code>anova()</code> knowing that it might be too liberal.</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb321-1" tabindex="-1"></a>mod1<span class="fl">.3</span>t <span class="ot">&lt;-</span> <span class="fu">lmer</span>(rootEx <span class="sc">~</span> endcentered <span class="sc">+</span> <span class="fu">I</span>(endcentered<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> (endcentered<span class="sc">|</span>subject), <span class="at">data =</span> Blackmore, <span class="at">control =</span> <span class="fu">lmerControl</span>(<span class="at">optimizer =</span><span class="st">&quot;Nelder_Mead&quot;</span>))</span>
<span id="cb321-2"><a href="longitudinal-models-with-upper-level-predictors.html#cb321-2" tabindex="-1"></a><span class="fu">anova</span>(mod1<span class="fl">.2</span>t, mod1<span class="fl">.3</span>t)</span></code></pre></div>
<pre><code>## Data: Blackmore
## Models:
## mod1.2t: rootEx ~ endcentered + (endcentered | subject)
## mod1.3t: rootEx ~ endcentered + I(endcentered^2) + (endcentered | subject)
##         npar    AIC    BIC  logLik -2*log(L)  Chisq Df Pr(&gt;Chisq)    
## mod1.2t    6 2038.6 2067.8 -1013.3    2026.6                         
## mod1.3t    7 2023.9 2057.9 -1005.0    2009.9 16.711  1  4.353e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb323-1" tabindex="-1"></a><span class="fu">summary</span>(mod1<span class="fl">.3</span>t)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: rootEx ~ endcentered + I(endcentered^2) + (endcentered | subject)
##    Data: Blackmore
## Control: lmerControl(optimizer = &quot;Nelder_Mead&quot;)
## 
## REML criterion at convergence: 2032.1
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.8748 -0.5449 -0.0113  0.4837  4.1950 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr
##  subject  (Intercept) 1.51468  1.2307       
##           endcentered 0.01197  0.1094   0.91
##  Residual             0.26089  0.5108       
## Number of obs: 945, groups:  subject, 231
## 
## Fixed effects:
##                  Estimate Std. Error t value
## (Intercept)      2.385443   0.122250  19.513
## endcentered      0.246183   0.032218   7.641
## I(endcentered^2) 0.010211   0.002473   4.129
## 
## Correlation of Fixed Effects:
##             (Intr) endcnt
## endcentered 0.818        
## I(ndcntr^2) 0.637  0.953</code></pre>
</div>
</div>
<div id="summary-1" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">10.4</span> Summary<a href="longitudinal-models-with-upper-level-predictors.html#summary-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Using the square-root transformation we arrive at the same conclusions as with un-transformed exercise, though deviance is lower, and the estimates of the intercept are a bit uninterpretable, more on that later. So we have that:</p>
<ul>
<li>The best fitting level 1 model is one with random intercepts and age slopes, and a fixed quadratic age term</li>
<li>Slope variance is not very large, but still significantly different from zero (as per our deviance test)</li>
<li>There are still some issues with a few level-1 residuals, namely that there are a few outlier observations.</li>
</ul>
<p>Despite some of the issues with outliers, we’ll attempt to explain the intercept and slope variance using the <code>group</code> factor, which is the explanatory variable of interest.</p>
</div>
<div id="adding-level-2-explanatory-variables" class="section level2 hasAnchor" number="10.5">
<h2><span class="header-section-number">10.5</span> Adding Level-2 Explanatory variables<a href="longitudinal-models-with-upper-level-predictors.html#adding-level-2-explanatory-variables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can have as many explanatory variables as we like (so far as our model is still identified) but with most datasets, you won’t have that many level-2 variables. Unlike cross-sectional MLMs, it isn’t necessary to create a level-2 aggregate predictor (e.g., like mean.ses) since it makes no sense to compute the average age for each girl. Thus, we can focus just on the <code>group</code> variable, which categorizes each girl as a patient or part of the control group.</p>
<p>Fitting this model is exactly the same as with cross-sectional, only now, we’re going to include a level-1 predictor that doesn’t vary: the quadratic age term. So, we want to make sure that our cross-level interaction only involves the linear age variable and group. Then we add in the quadratic effect before the random component. Also, since we were having convergence problems we’ll also continue to use the <code>Nedler_Mead</code> optimizer.</p>
<p>We’re also going to check assumptions of normal errors at both levels.</p>
<p>Level 1:</p>
<p><span class="math display">\[
Y_{ti} = \pi_{0i} + \pi_{1i}(a_{ti}-L) + \pi_{2i}(a_{ti}-L)^{2} e_{ij}
\]</span>
Level 2:</p>
<p><span class="math display">\[
\pi_{0i} = \beta_{00} + \beta_{01}Group_{i} + r_{0i}
\]</span>
<span class="math display">\[
\pi_{1i} = \beta_{10} + \beta_{11}Group_{i} + r_{1i}
\]</span>
<span class="math display">\[
\pi_{2i} = \beta_{20}
\]</span></p>
<p>Combined model:</p>
<p><span class="math display">\[
Y_{ti} = \beta_{00} + \beta_{01}Group_{i} + \beta_{10}(a_{ti}-L) + \beta_{11}(Group\times(a_{ti}-L)) + \beta_{20}(a_{ti}-L)^{2} + r_{0i} + r_{1i}(a_{ti}-L) + e_{ij}
\]</span></p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb325-1" tabindex="-1"></a>mod2<span class="fl">.1</span>a <span class="ot">&lt;-</span> <span class="fu">lmer</span>(rootEx <span class="sc">~</span> endcentered <span class="sc">+</span> group <span class="sc">+</span> endcentered<span class="sc">:</span>group <span class="sc">+</span> <span class="fu">I</span>(endcentered<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> (endcentered<span class="sc">|</span>subject), <span class="at">data =</span> Blackmore, <span class="at">control =</span> <span class="fu">lmerControl</span>(<span class="at">optimizer =</span><span class="st">&quot;Nelder_Mead&quot;</span>))</span>
<span id="cb325-2"><a href="longitudinal-models-with-upper-level-predictors.html#cb325-2" tabindex="-1"></a></span>
<span id="cb325-3"><a href="longitudinal-models-with-upper-level-predictors.html#cb325-3" tabindex="-1"></a><span class="co"># Level 1 residuals</span></span>
<span id="cb325-4"><a href="longitudinal-models-with-upper-level-predictors.html#cb325-4" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">residuals</span>(mod2<span class="fl">.1</span>a))</span></code></pre></div>
<p><img src="_main_files/figure-html/Blackmore2.110-1.png" width="672" /></p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb326-1" tabindex="-1"></a><span class="co"># level 2 residuals</span></span>
<span id="cb326-2"><a href="longitudinal-models-with-upper-level-predictors.html#cb326-2" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">ranef</span>(mod2<span class="fl">.1</span>a)<span class="sc">$</span>subject<span class="sc">$</span>endcentered)</span></code></pre></div>
<p><img src="_main_files/figure-html/Blackmore2.110-2.png" width="672" /></p>
<p>So as we see, the level-1 residuals are still not the best, but at level 2, we have what we need. With these caveats in mind, let’s now check out the results:</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb327-1" tabindex="-1"></a><span class="fu">summary</span>(mod2<span class="fl">.1</span>a)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: rootEx ~ endcentered + group + endcentered:group + I(endcentered^2) +  
##     (endcentered | subject)
##    Data: Blackmore
## Control: lmerControl(optimizer = &quot;Nelder_Mead&quot;)
## 
## REML criterion at convergence: 1997.2
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.9292 -0.5018 -0.0021  0.4899  4.1928 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr
##  subject  (Intercept) 1.230033 1.10907      
##           endcentered 0.008466 0.09201  0.89
##  Residual             0.259621 0.50953      
## Number of obs: 945, groups:  subject, 231
## 
## Fixed effects:
##                          Estimate Std. Error t value
## (Intercept)              1.623296   0.163399   9.935
## endcentered              0.149659   0.034294   4.364
## grouppatient             1.148317   0.179620   6.393
## I(endcentered^2)         0.008898   0.002449   3.634
## endcentered:grouppatient 0.127303   0.018451   6.900
## 
## Correlation of Fixed Effects:
##             (Intr) endcnt grpptn I(n^2)
## endcentered  0.782                     
## grouppatint -0.706 -0.345              
## I(ndcntr^2)  0.502  0.905 -0.052       
## endcntrd:gr -0.641 -0.396  0.885 -0.065</code></pre>
<p>Because we’ve taken the square-root (raised Y to the 1/2-power), but left the X’s untransformed, interpretation using the “change in Y for a unit change in X” is difficult.</p>
<p>This <a href="https://stats.stackexchange.com/questions/35982/how-to-interpret-regression-coefficients-when-response-was-transformed-by-the-4t">Cross-Validated answer</a> gives the gist of how cumbersome actual interpretation can be, but it goes something like this:</p>
<blockquote>
<p>The average within-subject slope is 0.15. This means that a unit change in age (1 year) yields <span class="math inline">\(2 \times 0.15 = 0.3\)</span> times the square of the current level of exercise (in hours per week).</p>
</blockquote>
<p>If we needed a more interpretable effect description, we could try another transformation, specifically, one that makes sense in the field or with respect to what we measured.</p>
<div id="visualizing-the-transformed-data" class="section level3 hasAnchor" number="10.5.1">
<h3><span class="header-section-number">10.5.1</span> Visualizing the transformed data<a href="longitudinal-models-with-upper-level-predictors.html#visualizing-the-transformed-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s make a new <code>ggplot</code> and see if the square root transform helps with data visualization. We’ll also add lines for each person to see if we can approximate the linear trend. Also, the <code>values</code> argument of <code>scale_color_manual</code> can take many different arguments including the names of colors as we have done above, and also <a href="https://www.color-hex.com/">Hex Color Codes</a> as I have included below (<code>c("#FEC601","#4F9CED")</code>).</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb329-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Blackmore, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> rootEx, <span class="at">col =</span> group, <span class="at">group =</span> subject)) <span class="sc">+</span></span>
<span id="cb329-2"><a href="longitudinal-models-with-upper-level-predictors.html#cb329-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> .<span class="dv">7</span>, <span class="at">position =</span> <span class="st">&quot;jitter&quot;</span>) <span class="sc">+</span></span>
<span id="cb329-3"><a href="longitudinal-models-with-upper-level-predictors.html#cb329-3" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb329-4"><a href="longitudinal-models-with-upper-level-predictors.html#cb329-4" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;#4F9CED&quot;</span>)) <span class="sc">+</span></span>
<span id="cb329-5"><a href="longitudinal-models-with-upper-level-predictors.html#cb329-5" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">se =</span> F, <span class="at">linewidth  =</span> .<span class="dv">4</span>, <span class="at">alpha  =</span> .<span class="dv">1</span>) <span class="sc">+</span> <span class="co"># to add regression line</span></span>
<span id="cb329-6"><a href="longitudinal-models-with-upper-level-predictors.html#cb329-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Square-root Exercise&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Exercise (square root) and age by group and participant&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;The within-person regression lines colored by group&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/graph210-1.png" width="672" /></p>
</div>
</div>
<div id="time-dependent-covariates" class="section level2 hasAnchor" number="10.6">
<h2><span class="header-section-number">10.6</span> Time dependent covariates<a href="longitudinal-models-with-upper-level-predictors.html#time-dependent-covariates" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As a final analysis, let’s examine a hypothetical effect of involvement in sports. These are simulated data added onto the exercise dataset.</p>
<p>We’ll add two variables: one hypothetical level-1 variable indicating if a girl played sports <strong>at that time</strong> and a level-2 variable indicating whether a girl <strong>ever played sports</strong></p>
<p>I’ve done this at random, but we can see that we have most of our level 1 sports time points in the patient group.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb330-1" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span>sports1 <span class="sc">+</span> group, <span class="at">data =</span> Blackmore)</span></code></pre></div>
<pre><code>##            group
## sports1     control patient
##   no sports     267     459
##   sports         92     127</code></pre>
<p>As an illustration, I’ll fit two models:</p>
<ol style="list-style-type: decimal">
<li>Using the level-1 sports variable: an indicator of whether the girl played a sport at the time of measurement (estimation) of exercise</li>
<li>Using the level-2 sports variable: an indicator of whether the girl <em>ever</em> played sports during her lifetime</li>
</ol>
<div id="level-1-time-dependent-sports-predictor" class="section level3 hasAnchor" number="10.6.1">
<h3><span class="header-section-number">10.6.1</span> Level-1: Time-dependent sports predictor<a href="longitudinal-models-with-upper-level-predictors.html#level-1-time-dependent-sports-predictor" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb332-1" tabindex="-1"></a>time_dep <span class="ot">&lt;-</span> <span class="fu">lmer</span>(rootEx <span class="sc">~</span> sports1 <span class="sc">+</span> age <span class="sc">+</span> (age<span class="sc">|</span>subject), <span class="at">data =</span> Blackmore)</span>
<span id="cb332-2"><a href="longitudinal-models-with-upper-level-predictors.html#cb332-2" tabindex="-1"></a><span class="fu">sumary</span>(time_dep)</span></code></pre></div>
<pre><code>## Fixed Effects:
##               coef.est coef.se
## (Intercept)   -0.07     0.10  
## sports1sports -0.02     0.05  
## age            0.12     0.01  
## 
## Random Effects:
##  Groups   Name        Std.Dev. Corr  
##  subject  (Intercept) 0.95           
##           age         0.11     -0.85 
##  Residual             0.52           
## ---
## number of obs: 945, groups: subject, 231
## AIC = 2056.5, DIC = 2010.5
## deviance = 2026.5</code></pre>
</div>
<div id="level-2-participant-level-indicator-of-sports-participation" class="section level3 hasAnchor" number="10.6.2">
<h3><span class="header-section-number">10.6.2</span> Level-2: Participant-level indicator of sports participation<a href="longitudinal-models-with-upper-level-predictors.html#level-2-participant-level-indicator-of-sports-participation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="longitudinal-models-with-upper-level-predictors.html#cb334-1" tabindex="-1"></a>Sports2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(rootEx <span class="sc">~</span> sports2 <span class="sc">+</span> age <span class="sc">+</span> (age<span class="sc">|</span>subject), <span class="at">data =</span> Blackmore)</span>
<span id="cb334-2"><a href="longitudinal-models-with-upper-level-predictors.html#cb334-2" tabindex="-1"></a><span class="fu">sumary</span>(Sports2)</span></code></pre></div>
<pre><code>## Fixed Effects:
##               coef.est coef.se
## (Intercept)   -0.01     0.11  
## sports2Sports -0.13     0.08  
## age            0.12     0.01  
## 
## Random Effects:
##  Groups   Name        Std.Dev. Corr  
##  subject  (Intercept) 0.94           
##           age         0.11     -0.85 
##  Residual             0.52           
## ---
## number of obs: 945, groups: subject, 231
## AIC = 2053.4, DIC = 2009
## deviance = 2024.2</code></pre>
<p>We can see that the coefficients are not the same. In the level-1 model, we have a (likely non-significant) difference in exercise at each time point that is small and favors those who didn’t play sports.</p>
<p>The level-2 sports variable, in contrast, gives us a test of the difference in intercepts (here the beginning of the study) between those who did and did not ever play sports. Note here, the difference is larger, but still likely not significant.</p>
<hr />

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="using-lme4-to-fit-mlm-to-longitudinal-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multilevel-logistic-regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
